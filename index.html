<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Bonus: Cyber Collector</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Courier New', monospace; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #game-ui { position: absolute; top: 20px; font-size: 28px; color: #00ffaa; text-shadow: 0 0 15px #00ffaa; z-index: 10; }
        canvas { background: #050505; border-top: 5px solid #00ffaa; border-bottom: 5px solid #00ffaa; box-shadow: 0 0 50px rgba(0, 255, 170, 0.1); }
        .tap-msg { position: absolute; bottom: 40px; color: #444; font-size: 14px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

<div id="game-ui">BONUS: <span id="score">0</span></div>
<canvas id="gameCanvas"></canvas>
<div class="tap-msg">TAP TO SWITCH GRAVITY</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');

canvas.width = window.innerWidth > 400 ? 400 : window.innerWidth;
canvas.height = 400;

let score = 0, gameActive = true, musicStarted = false;
const player = { x: 50, y: 360, w: 35, h: 35, targetY: 360, color: '#00ffaa' };
let items = [];

// High-Energy Synth Music
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSynthDrive() {
    if (musicStarted) return; musicStarted = true;
    setInterval(() => {
        if(!gameActive) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sawtooth';
        const notes = [110, 130, 146, 110, 164, 110];
        osc.frequency.setValueAtTime(notes[Math.floor(Date.now()/200)%6], audioCtx.currentTime);
        gain.gain.setValueAtTime(0.02, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }, 200);
}

// Gravity Switch Logic
const switchGravity = () => {
    playSynthDrive();
    if (player.targetY === 360) player.targetY = 5;
    else player.targetY = 360;
};

window.addEventListener('mousedown', switchGravity);
window.addEventListener('touchstart', (e) => { e.preventDefault(); switchGravity(); });

function spawnItem() {
    if (Math.random() < 0.04) {
        const type = Math.random() > 0.3 ? 'bonus' : 'trap';
        items.push({
            x: canvas.width + 50,
            y: Math.random() * (canvas.height - 100) + 50,
            w: 20, h: 20,
            type: type,
            speed: 4 + Math.random() * 3
        });
    }
}

function update() {
    if (!gameActive) return;

    // Smooth Gravity Slide
    player.y += (player.targetY - player.y) * 0.2;

    items.forEach((item, i) => {
        item.x -= item.speed;

        // Collision detection
        if (player.x < item.x + item.w && player.x + player.w > item.x &&
            player.y < item.y + item.h && player.y + player.h > item.y) {
            
            if (item.type === 'bonus') {
                score += 10;
                scoreEl.innerText = score;
                items.splice(i, 1);
                createPulse();
            } else {
                gameOver();
            }
        }

        if (item.x < -50) items.splice(i, 1);
    });
}

let pulse = 0;
function createPulse() { pulse = 15; }

function draw() {
    // Cyber Background
    ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Pulse effect on background
    if (pulse > 0) {
        ctx.strokeStyle = `rgba(0, 255, 170, ${pulse/15})`;
        ctx.lineWidth = pulse;
        ctx.strokeRect(0, 0, canvas.width, canvas.height);
        pulse--;
    }

    // Grid lines for style
    ctx.strokeStyle = '#111'; ctx.lineWidth = 1;
    for(let i=0; i<canvas.width; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,400); ctx.stroke(); }

    // Player
    ctx.shadowBlur = 15; ctx.shadowColor = player.color;
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // Items
    items.forEach(item => {
        if (item.type === 'bonus') {
            ctx.fillStyle = '#ffdd00'; ctx.shadowColor = '#ffdd00';
            ctx.beginPath(); ctx.arc(item.x + 10, item.y + 10, 8, 0, Math.PI*2); ctx.fill();
        } else {
            ctx.fillStyle = '#ff0055'; ctx.shadowColor = '#ff0055';
            ctx.fillRect(item.x, item.y, 20, 20);
        }
    });

    ctx.shadowBlur = 0;
    update();
    spawnItem();
    requestAnimationFrame(draw);
}

function gameOver() {
    gameActive = false;
    alert("SYSTEM OVERLOAD! Final Bonus: " + score);
    location.reload();
}

draw();
</script>
</body>
</html>